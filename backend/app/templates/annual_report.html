<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Årsredovisning för {{ company_name }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm 1.5cm;
            @bottom-center {
                content: "Sida " counter(page);
                font-size: 10pt;
                color: #555;
            }
        }
        body { font-family: 'Times New Roman', Times, serif; font-size: 11pt; line-height: 1.4; }
        h1, h2, h3 { font-family: 'Helvetica', 'Arial', sans-serif; color: #000; font-weight: bold; }
        h1 { font-size: 22pt; text-align: center; margin-bottom: 2cm; }
        h2 { font-size: 14pt; border-bottom: 1.5px solid #000; padding-bottom: 4px; margin-top: 1.5cm; margin-bottom: 0.8cm; page-break-before: auto; page-break-after: avoid; }
        h3 { font-size: 12pt; margin-top: 1cm; margin-bottom: 0.5cm; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 4px 6px; text-align: left; vertical-align: top; }
        .report-table th { font-weight: bold; }
        .report-table td:nth-child(2), .report-table th:nth-child(2) { text-align: right; }
        .report-table td:nth-child(3), .report-table th:nth-child(3) { text-align: right; }
        .header-row { border-bottom: 1px solid #333; }
        .total-row td { font-weight: bold; border-top: 1px solid #333; border-bottom: 2px double #000; padding-top: 6px; }
        .sub-total-row td { font-weight: bold; border-top: 1px solid #333; }
        .indent { padding-left: 20px; }
        .signatures { margin-top: 2cm; display: block; page-break-inside: avoid; }
        .signature-block { display: inline-block; width: 45%; margin-right: 5%; margin-top: 1.5cm; }
        .signature-line { border-bottom: 1px solid #000; margin-top: 2cm; }
        .watermark { position: fixed; top: 45%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 120px; color: rgba(128, 128, 128, 0.15); font-weight: bold; pointer-events: none; z-index: -1; }
    </style>
</head>
<body>
    {% if is_preview %}
    <div class="watermark">UTKAST</div>
    {% endif %}

    <h1>Årsredovisning</h1>
    <h2>{{ company_name }} ({{ org_nr }})</h2>
    <p>för räkenskapsåret {{ start_date.strftime('%Y-%m-%d') }} - {{ end_date.strftime('%Y-%m-%d') }}</p>

    <h2>Förvaltningsberättelse</h2>
    <p>{{ forvaltningsberattelse | replace('\n', '<br>') | safe }}</p>
    <h3>Resultatdisposition</h3>
    <p>Styrelsen föreslår att till förfogande stående vinstmedel, {{ (k2_results.free_equity + k2_results.profit_loss) | round(0) | int }} kr, disponeras enligt följande:</p>
    <ul>
        <li>Balanseras i ny räkning: {{ (k2_results.free_equity + k2_results.profit_loss) | round(0) | int }} kr</li>
    </ul>

    <h2>Resultaträkning</h2>
    <table class="report-table">
        <tr class="header-row">
            <th></th>
            <th>{{ end_date.year }}<br>SEK</th>
            <th>Föregående år<br>SEK</th>
        </tr>
        <tr><td colspan="3"><h3>Rörelsens intäkter</h3></td></tr>
        <tr><td class="indent">Nettoomsättning</td><td>{{ k2_results.income_statement.net_sales | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.net_sales | round(0) | int }}</td></tr>
        <tr><td colspan="3"><h3>Rörelsekostnader</h3></td></tr>
        <tr><td class="indent">Handelsvaror</td><td>{{ k2_results.income_statement.cost_of_goods | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.cost_of_goods | round(0) | int }}</td></tr>
        <tr><td class="indent">Övriga externa kostnader</td><td>{{ k2_results.income_statement.other_external_costs | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.other_external_costs | round(0) | int }}</td></tr>
        <tr><td class="indent">Personalkostnader</td><td>{{ k2_results.income_statement.personnel_costs | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.personnel_costs | round(0) | int }}</td></tr>
        <tr><td class="indent">Av- och nedskrivningar</td><td>{{ k2_results.income_statement.depreciation | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.depreciation | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td class="indent">Summa rörelsekostnader</td><td>{{ k2_results.income_statement.total_operating_expenses | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.total_operating_expenses | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td><strong>Rörelseresultat</strong></td><td>{{ k2_results.income_statement.operating_profit | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.operating_profit | round(0) | int }}</td></tr>
        <tr><td colspan="3"><h3>Finansiella poster</h3></td></tr>
        <tr><td class="indent">Resultat från finansiella poster</td><td>{{ k2_results.income_statement.financial_items | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.financial_items | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td><strong>Resultat efter finansiella poster</strong></td><td>{{ k2_results.income_statement.profit_after_financial_items | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.profit_after_financial_items | round(0) | int }}</td></tr>
        <tr><td>Skatt på årets resultat</td><td>{{ k2_results.income_statement.tax | round(0) | int }}</td><td>{{ k2_results.income_statement_prev.tax | round(0) | int }}</td></tr>
        <tr class="total-row"><td><strong>ÅRETS RESULTAT</strong></td><td>{{ k2_results.profit_loss | round(0) | int }}</td><td>{{ k2_results.profit_loss_prev | round(0) | int }}</td></tr>
    </table>

    <h2 style="page-break-before: always;">Balansräkning</h2>
    <table class="report-table">
        <tr class="header-row">
            <th>TILLGÅNGAR</th>
            <th>{{ end_date.strftime('%Y-%m-%d') }}<br>SEK</th>
            <th>{{ (end_date.replace(year=end_date.year-1)).strftime('%Y-%m-%d') }}<br>SEK</th>
        </tr>
        <tr><td colspan="3"><h3>Anläggningstillgångar</h3></td></tr>
        <tr><td class="indent">Materiella anläggningstillgångar</td><td>{{ k2_results.balance_sheet.fixed_assets_tangible | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.fixed_assets_tangible | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td><strong>Summa anläggningstillgångar</strong></td><td>{{ k2_results.balance_sheet.total_fixed_assets | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.total_fixed_assets | round(0) | int }}</td></tr>
        <tr><td colspan="3"><h3>Omsättningstillgångar</h3></td></tr>
        <tr><td class="indent">Varulager m.m.</td><td>{{ k2_results.balance_sheet.inventory | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.inventory | round(0) | int }}</td></tr>
        <tr><td class="indent">Kortfristiga fordringar</td><td>{{ k2_results.balance_sheet.current_receivables | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.current_receivables | round(0) | int }}</td></tr>
        <tr><td class="indent">Kassa och Bank</td><td>{{ k2_results.balance_sheet.cash_and_bank | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.cash_and_bank | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td><strong>Summa omsättningstillgångar</strong></td><td>{{ k2_results.balance_sheet.total_current_assets | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.total_current_assets | round(0) | int }}</td></tr>
        <tr class="total-row"><td><strong>SUMMA TILLGÅNGAR</strong></td><td>{{ k2_results.total_assets | round(0) | int }}</td><td>{{ k2_results.total_assets_prev | round(0) | int }}</td></tr>
    </table>
    <table class="report-table" style="margin-top: 1cm;">
        <tr class="header-row">
            <th>EGET KAPITAL OCH SKULDER</th>
            <th>{{ end_date.strftime('%Y-%m-%d') }}<br>SEK</th>
            <th>{{ (end_date.replace(year=end_date.year-1)).strftime('%Y-%m-%d') }}<br>SEK</th>
        </tr>
        <tr><td colspan="3"><h3>Eget kapital</h3></td></tr>
        <tr><td class="indent">Aktiekapital</td><td>{{ k2_results.balance_sheet.restricted_equity | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.restricted_equity | round(0) | int }}</td></tr>
        <tr><td class="indent">Balanserat resultat</td><td>{{ k2_results.free_equity | round(0) | int }}</td><td>{{ k2_results.free_equity_prev | round(0) | int }}</td></tr>
        <tr><td class="indent">Årets resultat</td><td>{{ k2_results.profit_loss | round(0) | int }}</td><td>{{ k2_results.profit_loss_prev | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td><strong>Summa eget kapital</strong></td><td>{{ k2_results.total_equity | round(0) | int }}</td><td>{{ k2_results.total_equity_prev | round(0) | int }}</td></tr>
        <tr><td colspan="3"><h3>Obeskattade reserver</h3></td></tr>
        <tr><td class="indent">Periodiseringsfonder</td><td>{{ k2_results.balance_sheet.untaxed_reserves | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.untaxed_reserves | round(0) | int }}</td></tr>
        <tr><td colspan="3"><h3>Skulder</h3></td></tr>
        <tr><td class="indent">Långfristiga skulder</td><td>{{ k2_results.balance_sheet.long_term_liabilities | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.long_term_liabilities | round(0) | int }}</td></tr>
        <tr><td class="indent">Kortfristiga skulder</td><td>{{ k2_results.balance_sheet.current_liabilities | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.current_liabilities | round(0) | int }}</td></tr>
        <tr class="sub-total-row"><td><strong>Summa skulder</strong></td><td>{{ k2_results.balance_sheet.total_liabilities | round(0) | int }}</td><td>{{ k2_results.balance_sheet_prev.total_liabilities | round(0) | int }}</td></tr>
        <tr class="total-row"><td><strong>SUMMA EGET KAPITAL OCH SKULDER</strong></td><td>{{ k2_results.total_equity_and_liabilities | round(0) | int }}</td><td>{{ k2_results.total_equity_and_liabilities_prev | round(0) | int }}</td></tr>
    </table>

    <div class="signatures">
        <h2>Underskrifter</h2>
        <p>Härmed intygas att resultaträkningen och balansräkningen har fastställts på årsstämma {{ signature_date.strftime('%Y-%m-%d') }}.</p>
        <br>
        <p>{{ signature_city }}, den {{ signature_date.strftime('%Y-%m-%d') }}</p>
        
        {% for rep in representatives %}
        <div class="signature-block">
            <div class="signature-line"></div>
            <p>{{ rep.name }}<br>{{ rep.role }}</p>
        </div>
        {% endfor %}
    </div>
</body>
</html>
